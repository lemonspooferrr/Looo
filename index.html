<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>🎧 Test Micro + Audio Loopback - LemonSpoofer</title>
</head>
<body>
    <h1>🔊 Test Micro + Écoute immédiate (Loopback)</h1>
    <button onclick="startTest()">🎧 Activer le micro</button>
    <p id="status" style="font-weight:bold;"></p>
    <audio id="audio" autoplay controls style="margin-top:20px;"></audio>

    <script>
        const status = document.getElementById("status");
        const audio = document.getElementById("audio");

        function log(msg) {
            status.innerText = msg;
            console.log("[DEBUG]", msg);
        }

        async function startTest() {
            log("🔍 Demande d'accès au micro...");

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const track = stream.getAudioTracks()[0];

                if (track) {
                    log("✅ Micro actif : " + track.label);
                    audio.srcObject = stream;
                } else {
                    log("⚠️ Aucune piste audio détectée.");
                }

            } catch (err) {
                log("❌ Échec : " + err.name + " - " + err.message);
                console.error(err);
            }
        }
    </script>
</body>
</html>
