<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>LemonSpoofer - Appel Spoof + Test Micro</title>
</head>
<body>
    <h1>ğŸ§ LemonSpoofer - Interface ComplÃ¨te</h1>

    <h2>ğŸ™ï¸ Test Micro (Loopback)</h2>
    <button onclick="testMicro()">ğŸ§ Tester le micro</button>
    <p id="mic-status" style="color:#444;font-weight:bold;"></p>
    <audio id="mic-audio" autoplay controls style="margin-top:10px;"></audio>

    <hr>

    <h2>ğŸ“ Appel Spoof (SIP.js)</h2>
    <p>ğŸ“¤ <b>Caller ID :</b> +33969353969<br>
       ğŸ¯ <b>Vers :</b> +33756836479</p>
    <button onclick="startCall()">ğŸ“² Appeler maintenant</button>
    <p id="call-status" style="color:#444;font-weight:bold;"></p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sip.js/0.20.0/sip.min.js"></script>
    <script>
        const micStatus = document.getElementById("mic-status");
        const micAudio = document.getElementById("mic-audio");
        const callStatus = document.getElementById("call-status");

        // Test micro
        async function testMicro() {
            micStatus.innerText = "ğŸ” Test micro en cours...";
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const track = stream.getAudioTracks()[0];
                if (track) {
                    micStatus.innerText = "âœ… Micro actif : " + track.label;
                    micAudio.srcObject = stream;
                } else {
                    micStatus.innerText = "âš ï¸ Aucune piste audio dÃ©tectÃ©e.";
                }
            } catch (err) {
                micStatus.innerText = "âŒ Micro refusÃ© : " + err.name;
                console.error(err);
            }
        }

        // Configuration SIP.js
        const userAgent = new SIP.UA({
            uri: 'testspoof123@sip.portsip.com',
            transportOptions: {
                wsServers: ['wss://sip.portsip.com:5063'],
                traceSip: true
            },
            authorizationUser: 'testspoof123',
            password: 'x6f89sPoof',
            displayName: '+33969353969'
        });

        userAgent.on('connected', () => callStatus.innerText = "âœ… ConnectÃ© au serveur SIP.");
        userAgent.on('disconnected', () => callStatus.innerText = "âŒ DÃ©connectÃ© du serveur SIP.");

        function startCall() {
            callStatus.innerText = "ğŸ“ Appel en cours...";
            navigator.mediaDevices.getUserMedia({ audio: true }).then(() => {
                const target = 'sip:+33756836479@sip.portsip.com';
                const session = userAgent.invite(target, {
                    sessionDescriptionHandlerOptions: {
                        constraints: {
                            audio: {
                                echoCancellation: true,
                                noiseSuppression: true
                            },
                            video: false
                        },
                        peerConnectionOptions: {
                            rtcConfiguration: {
                                iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
                            }
                        }
                    }
                });

                session.on('accepted', () => callStatus.innerText = "âœ… Appel acceptÃ© !");
                session.on('rejected', () => callStatus.innerText = "âŒ Appel rejetÃ©.");
                session.on('failed', () => callStatus.innerText = "âŒ Ã‰chec de l'appel.");
                session.on('bye', () => callStatus.innerText = "ğŸ“´ Appel terminÃ©.");
            }).catch(err => {
                callStatus.innerText = "âŒ Erreur micro pour appel : " + err.name;
                console.error(err);
            });
        }
    </script>
</body>
</html>
