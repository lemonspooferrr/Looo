<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LemonSpoofer - Test Appel Spoof</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sip.js/0.20.0/sip.min.js"></script>
</head>
<body>
  <h2>📞 LemonSpoofer - Test Appel Spoof</h2>

  <p>Micro : <span style="color:green;">🟢 Micro actif détecté</span></p>
  <button onclick="startCall()">📲 Appeler maintenant</button>

  <p id="status">⏳ UA en attente...</p>

  <script>
    // Configuration SIP
    const userAgent = new SIP.UA({
      uri: 'spoofuser@sip.onsip.com',
      transportOptions: {
        wsServers: ['wss://sip.onsip.com:7443']
      },
      authorizationUser: 'spoofuser',
      password: 'spoofpass123',
      hackIpInContact: true
    });

    userAgent.on('connected', () => {
      document.getElementById('status').innerText = '✅ Connexion établie';
    });

    userAgent.on('disconnected', () => {
      document.getElementById('status').innerText = '❌ Déconnecté';
    });

    function startCall() {
      const target = 'sip:+33756836479@sip.onsip.com';
      const session = userAgent.invite(target, {
        media: {
          constraints: { audio: true, video: false },
          render: {
            remote: document.createElement('audio'),
            local: document.createElement('audio')
          }
        }
      });

      session.on('accepted', () => {
        document.getElementById('status').innerText = '📞 Appel accepté';
      });

      session.on('bye', () => {
        document.getElementById('status').innerText = '🛑 Appel terminé';
      });

      session.on('failed', () => {
        document.getElementById('status').innerText = '❌ Appel échoué';
      });
    }
  </script>
</body>
</html>
