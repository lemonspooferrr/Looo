<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>LemonSpoofer - Spoof WebRTC</title>
</head>
<body>
  <h1>ğŸ§ LemonSpoofer - Interface ComplÃ¨te</h1>

  <h2>ğŸ™ï¸ Test Micro (Loopback)</h2>
  <button onclick="testMicro()">ğŸ§ Tester le micro</button>
  <p id="mic-status"></p>
  <audio id="mic-audio" autoplay controls></audio>

  <hr>

  <h2>ğŸ“ Appel Spoof (SIP.js)</h2>
  <p>ğŸ“¤ <b>Caller ID :</b> +33969353969<br>
     ğŸ¯ <b>Vers :</b> +33756836479</p>
  <button onclick="startCall()">ğŸ“² Appeler maintenant</button>
  <p id="call-status"></p>

  <!-- âœ… SIP.js v0.20 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sip.js/0.20.0/sip.min.js"></script>

  <script>
    const micStatus = document.getElementById("mic-status");
    const micAudio = document.getElementById("mic-audio");
    const callStatus = document.getElementById("call-status");

    function testMicro() {
      micStatus.innerText = "ğŸ” Test micro en cours...";
      navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        micStatus.innerText = "âœ… Micro actif dÃ©tectÃ©.";
        micAudio.srcObject = stream;
      }).catch(err => {
        micStatus.innerText = "âŒ AccÃ¨s au micro refusÃ© : " + err.message;
      });
    }

    // ğŸŸ¢ SIP.js sans UA destructurÃ©
    const userAgent = new window.SIP.UA({
      uri: 'testspoof123@sip.portsip.com',
      transportOptions: {
        wsServers: ['wss://sip.portsip.com:5063'],
        traceSip: true
      },
      authorizationUser: 'testspoof123',
      password: 'x6f89sPoof',
      displayName: '+33969353969'
    });

    userAgent.on('connected', () => callStatus.innerText = "âœ… ConnectÃ© au serveur SIP.");
    userAgent.on('disconnected', () => callStatus.innerText = "âŒ DÃ©connectÃ© du serveur SIP.");

    function startCall() {
      callStatus.innerText = "ğŸ“ Connexion en cours...";
      navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        const session = userAgent.invite('sip:+33756836479@sip.portsip.com', {
          media: {
            stream: stream
          }
        });

        session.on('accepted', () => callStatus.innerText = "âœ… Appel acceptÃ© !");
        session.on('bye', () => callStatus.innerText = "ğŸ“´ Appel terminÃ©.");
        session.on('failed', () => callStatus.innerText = "âŒ Ã‰chec de lâ€™appel.");
      }).catch(err => {
        callStatus.innerText = "âŒ Erreur micro : " + err.message;
      });
    }
  </script>
</body>
</html>
