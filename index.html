<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LemonSpoofer - Appel Spoof WebRTC</title>
</head>
<body>
    <h2>📞 LemonSpoofer - Interface Complète</h2>

    <h3>🎤 Test Micro (Loopback)</h3>
    <button onclick="testMicro()">Tester le micro</button>
    <p id="microStatus">🔁 En attente...</p>
    <audio id="microPlayer" controls></audio>

    <hr>

    <h3>📞 Appel Spoof (SIP.js)</h3>
    <p>📟 <b>Caller ID :</b> +33969353969<br>
       🌐 <b>Vers :</b> +33756836479</p>
    <button onclick="startCall()">📞 Appeler maintenant</button>
    <p id="callStatus">🕓 En attente...</p>

    <script src="https://cdn.jsdelivr.net/npm/sip.js@0.20.0/lib/sip.min.js"></script>
    <script>
        let userAgent;

        async function testMicro() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const player = document.getElementById("microPlayer");
                player.srcObject = stream;
                player.play();
                document.getElementById("microStatus").innerHTML = "✅ Micro actif détecté.";
            } catch (e) {
                document.getElementById("microStatus").innerHTML = "❌ Micro refusé.";
            }
        }

        window.onload = () => {
            userAgent = new SIP.UA({
                uri: 'testsipxyz@edge.portsip.com',
                transportOptions: {
                    wsServers: ['wss://edge.portsip.com:8888'],
                    traceSip: true
                },
                authorizationUser: 'testsipxyz',
                password: 't3stP@ssw0rd!',
                displayName: '+33969353969'
            });
        };

        function startCall() {
            if (!userAgent) {
                document.getElementById("callStatus").innerHTML = "❌ UA non initialisé.";
                return;
            }

            const session = userAgent.invite('sip:+33756836479@edge.portsip.com', {
                media: {
                    constraints: {
                        audio: true,
                        video: false
                    }
                }
            });

            session.on('progress', () => {
                document.getElementById("callStatus").innerHTML = "📞 Appel en cours...";
            });

            session.on('accepted', () => {
                document.getElementById("callStatus").innerHTML = "✅ Appel accepté.";
            });

            session.on('failed', () => {
                document.getElementById("callStatus").innerHTML = "❌ Échec de l’appel.";
            });
        }
    </script>
</body>
</html>
