<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>LemonSpoofer - Test Appel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sip.js/0.20.0/sip.min.js"></script>
</head>
<body>
  <h2>ğŸ“ LemonSpoofer - Test Appel Spoof</h2>
  <p>Micro : <span id="mic-status">ğŸŸ  Non dÃ©tectÃ©</span></p>
  <button onclick="startCall()">ğŸ“² Appeler maintenant</button>
  <p id="call-status">En attenteâ€¦</p>

  <script>
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      document.getElementById('mic-status').innerText = 'ğŸŸ¢ Micro actif dÃ©tectÃ©';
    }).catch(err => {
      document.getElementById('mic-status').innerText = 'ğŸ”´ Micro refusÃ©';
    });

    let userAgent;

    function startCall() {
      const target = 'sip:+33756836479@fr1.portsip.com';
      const uri = 'sip:lemonspoof@fr1.portsip.com';

      const userAgentOptions = {
        uri: SIP.UserAgent.makeURI(uri),
        authorizationUsername: 'lemonspoof',
        authorizationPassword: 'Lemon2025!',
        transportOptions: {
          server: 'wss://fr1.portsip.com:5061'
        },
        displayName: '+33969353969', // SpoofÃ© ici
        sessionDescriptionHandlerFactoryOptions: {
          constraints: { audio: true, video: false }
        }
      };

      userAgent = new SIP.UserAgent(userAgentOptions);

      userAgent.start().then(() => {
        const inviter = new SIP.Inviter(userAgent, SIP.UserAgent.makeURI(target));
        inviter.invite().then(() => {
          document.getElementById('call-status').innerText = 'âœ… Appel lancÃ© vers +33756836479â€¦';
        }).catch(error => {
          document.getElementById('call-status').innerText = 'âŒ Erreur appel : ' + error.message;
        });
      }).catch(error => {
        document.getElementById('call-status').innerText = 'âŒ UA non dÃ©marrÃ©e : ' + error.message;
      });
    }
  </script>
</body>
</html>
