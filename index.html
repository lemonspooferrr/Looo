<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LemonSpoofer - Test Appel Spoof</title>
  <!-- âœ… IMPORT SIP.JS -->
  <script src="https://unpkg.com/sip.js@0.20.0/dist/sip.min.js"></script>
</head>
<body>
  <h2>ğŸ“ LemonSpoofer - Test Appel Spoof</h2>
  <p>Micro : <span style="color:green;">ğŸŸ¢ Micro actif dÃ©tectÃ©</span></p>
  <button onclick="startCall()">ğŸ“² Appeler maintenant</button>
  <p id="status">â³ UA en attente...</p>

  <script>
    let userAgent;

    window.addEventListener('DOMContentLoaded', () => {
      try {
        userAgent = new SIP.UA({
          uri: 'spoofuser@sip.onsip.com',
          transportOptions: {
            wsServers: ['wss://sip.onsip.com:7443']
          },
          authorizationUser: 'spoofuser',
          password: 'spoofpass123',
          hackIpInContact: true
        });

        userAgent.on('connected', () => {
          document.getElementById('status').innerText = 'âœ… Connexion Ã©tablie';
        });

        userAgent.on('disconnected', () => {
          document.getElementById('status').innerText = 'âŒ DÃ©connectÃ©';
        });

      } catch (err) {
        document.getElementById('status').innerText = 'âŒ Erreur de crÃ©ation UA';
        console.error(err);
      }
    });

    function startCall() {
      if (!userAgent) {
        document.getElementById('status').innerText = 'âŒ UA non initialisÃ©e';
        return;
      }

      const target = 'sip:+33756836479@sip.onsip.com';
      const session = userAgent.invite(target, {
        sessionDescriptionHandlerOptions: {
          constraints: { audio: true, video: false }
        }
      });

      session.on('accepted', () => {
        document.getElementById('status').innerText = 'ğŸ“ Appel acceptÃ©';
      });

      session.on('bye', () => {
        document.getElementById('status').innerText = 'ğŸ›‘ Appel terminÃ©';
      });

      session.on('failed', () => {
        document.getElementById('status').innerText = 'âŒ Appel Ã©chouÃ©';
      });
    }
  </script>
</body>
</html>
