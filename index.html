<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>LemonSpoofer - Test Appel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sip.js/0.20.0/sip.min.js"></script>
</head>
<body>
  <h2>📞 LemonSpoofer - Test Appel Spoof</h2>
  <p>Micro : <span id="mic-status">🟠 Non détecté</span></p>
  <button onclick="startCall()">📲 Appeler maintenant</button>
  <p id="call-status">En attente…</p>

  <script>
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      document.getElementById('mic-status').innerText = '🟢 Micro actif détecté';
    }).catch(err => {
      document.getElementById('mic-status').innerText = '🔴 Micro refusé';
    });

    let userAgent;

    function startCall() {
      const target = 'sip:+33756836479@fr1.portsip.com';
      const uri = 'sip:lemonspoof@fr1.portsip.com';

      const userAgentOptions = {
        uri: SIP.UserAgent.makeURI(uri),
        authorizationUsername: 'lemonspoof',
        authorizationPassword: 'Lemon2025!',
        transportOptions: {
          server: 'wss://fr1.portsip.com:5061'
        },
        displayName: '+33969353969', // Spoofé ici
        sessionDescriptionHandlerFactoryOptions: {
          constraints: { audio: true, video: false }
        }
      };

      userAgent = new SIP.UserAgent(userAgentOptions);

      userAgent.start().then(() => {
        const inviter = new SIP.Inviter(userAgent, SIP.UserAgent.makeURI(target));
        inviter.invite().then(() => {
          document.getElementById('call-status').innerText = '✅ Appel lancé vers +33756836479…';
        }).catch(error => {
          document.getElementById('call-status').innerText = '❌ Erreur appel : ' + error.message;
        });
      }).catch(error => {
        document.getElementById('call-status').innerText = '❌ UA non démarrée : ' + error.message;
      });
    }
  </script>
</body>
</html>
