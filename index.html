<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LemonSpoofer - Appel Spoof WebRTC</title>
</head>
<body>
    <h2>ğŸ“ LemonSpoofer - Interface ComplÃ¨te</h2>

    <h3>ğŸ¤ Test Micro (Loopback)</h3>
    <button onclick="testMicro()">Tester le micro</button>
    <p id="microStatus">ğŸ” En attente...</p>
    <audio id="microPlayer" controls></audio>

    <hr>

    <h3>ğŸ“ Appel Spoof (SIP.js)</h3>
    <p>ğŸ“Ÿ <b>Caller ID :</b> +33969353969<br>
       ğŸŒ <b>Vers :</b> +33756836479</p>
    <button onclick="startCall()">ğŸ“ Appeler maintenant</button>
    <p id="callStatus">ğŸ•“ En attente...</p>

    <script src="https://cdn.jsdelivr.net/npm/sip.js@0.20.0/lib/sip.min.js"></script>
    <script>
        let userAgent;

        async function testMicro() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const player = document.getElementById("microPlayer");
                player.srcObject = stream;
                player.play();
                document.getElementById("microStatus").innerHTML = "âœ… Micro actif dÃ©tectÃ©.";
            } catch (e) {
                document.getElementById("microStatus").innerHTML = "âŒ Micro refusÃ©.";
            }
        }

        window.onload = () => {
            userAgent = new SIP.UA({
                uri: 'testsipxyz@edge.portsip.com',
                transportOptions: {
                    wsServers: ['wss://edge.portsip.com:8888'],
                    traceSip: true
                },
                authorizationUser: 'testsipxyz',
                password: 't3stP@ssw0rd!',
                displayName: '+33969353969'
            });
        };

        function startCall() {
            if (!userAgent) {
                document.getElementById("callStatus").innerHTML = "âŒ UA non initialisÃ©.";
                return;
            }

            const session = userAgent.invite('sip:+33756836479@edge.portsip.com', {
                media: {
                    constraints: {
                        audio: true,
                        video: false
                    }
                }
            });

            session.on('progress', () => {
                document.getElementById("callStatus").innerHTML = "ğŸ“ Appel en cours...";
            });

            session.on('accepted', () => {
                document.getElementById("callStatus").innerHTML = "âœ… Appel acceptÃ©.";
            });

            session.on('failed', () => {
                document.getElementById("callStatus").innerHTML = "âŒ Ã‰chec de lâ€™appel.";
            });
        }
    </script>
</body>
</html>
